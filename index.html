<!doctype html>
<html lang="ca">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>CEFS Manlleu ‚Äî R√†dio en directe</title>
<meta name="theme-color" content="#000000" />
<style>
  :root{
    --bg:#0b0b10;--card:#12121a;--txt:#e9f1ff;--muted:#8ea3c2;
    --acc:#39d0ff;--acc2:#00ffa3;--danger:#ff4d6d;
  }
  *{box-sizing:border-box}
  body{margin:0;background:radial-gradient(1200px 600px at 20% -10%, #1a2335 0%, #0b0b10 60%), #0b0b10;color:var(--txt);font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial}
  .wrap{max-width:880px;margin:32px auto;padding:16px}
  .card{background:linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));border:1px solid rgba(255,255,255,.08);border-radius:16px;padding:20px;box-shadow:0 10px 30px rgba(0,0,0,.35)}
  h1{font-size:28px;margin:0 0 8px}
  .sub{color:var(--muted);margin:0 0 18px}
  .row{display:flex;flex-wrap:wrap;gap:16px;align-items:center}
  .grow{flex:1 1 240px}
  .btn{cursor:pointer;border:0;border-radius:12px;padding:12px 18px;font-weight:700;
       color:#001018;background:linear-gradient(90deg,var(--acc),var(--acc2));
       box-shadow:0 6px 18px rgba(57,208,255,.35);transition:.2s transform}
  .btn:active{transform:scale(.98)}
  .muted{color:var(--muted)}
  .pill{display:inline-flex;gap:8px;align-items:center;
        border:1px solid rgba(255,255,255,.1);border-radius:999px;padding:8px 12px;background:rgba(0,0,0,.25)}
  .track{font-size:18px;font-weight:700}
  .eq{display:inline-flex;gap:3px;height:18px}
  .bar{width:3px;background:linear-gradient(var(--acc),var(--acc2));border-radius:2px;animation:vu 1.1s ease-in-out infinite}
  .bar:nth-child(2){animation-duration:1.0s}.bar:nth-child(3){animation-duration:1.25s}
  .bar:nth-child(4){animation-duration:.9s}.bar:nth-child(5){animation-duration:1.15s}
  @keyframes vu{0%{height:20%}50%{height:100%}100%{height:25%}}
  .vol{width:160px}
  audio{width:100%;height:40px;margin-top:10px}
  footer{opacity:.7;margin-top:22px;font-size:13px}
  .err{color:var(--danger);font-weight:700}
</style>
</head>
<body>
<div class="wrap">
  <div class="card">
    <h1>CEFS Manlleu ‚Äî Escolta en directe</h1>
    <p class="sub">Emissi√≥ oficial del club. M√∫sica i locuci√≥ en directe.</p>

    <div class="row">
      <button id="playBtn" class="btn">‚ñ∂ Reproduir</button>
      <label class="pill">
        üîä Volum
        <input id="vol" class="vol" type="range" min="0" max="1" step="0.01" value="1">
      </label>
      <span id="state" class="muted pill">‚è∏ Aturat</span>
    </div>

    <div style="margin-top:16px" class="row">
      <div class="grow">
        <div class="muted" style="margin-bottom:6px">Ara sona</div>
        <div class="track" id="now">‚Äî</div>
      </div>
      <div class="pill">
        <div class="eq" aria-hidden="true">
          <div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div>
        </div>
        <span class="muted">metadades</span>
      </div>
      <button id="refresh" class="btn" style="background:linear-gradient(90deg,#ffd43b,#ffa94d);box-shadow:none;color:#2b1700">‚Üª Actualitza</button>
    </div>

    <audio id="player" crossorigin="anonymous"></audio>

    <footer>
      <span id="metaStatus" class="muted">Actualitzant t√≠tol cada 10 s‚Ä¶</span>
    </footer>
  </div>
</div>

<script>
/*** üëá CONFIG ***/
const STREAM_URL  = "http://sonic2.sistemahost.es:8120/stream"; // canvia a https si el teu pla ho admet
const STATUS_URLS = [
  // Icecast (global)
  "http://sonic2.sistemahost.es:8120/status-json.xsl",
  // Icecast mount espec√≠fic (si cal)
  "http://sonic2.sistemahost.es:8120/status-json.xsl?mount=/stream",
  // Shoutcast v2 (sid 1)
  "http://sonic2.sistemahost.es:8120/stats?sid=1&json=1"
];
/***  END CONFIG ***/

const a = document.getElementById('player');
const btn = document.getElementById('playBtn');
const st = document.getElementById('state');
const now = document.getElementById('now');
const vol = document.getElementById('vol');
const metaStatus = document.getElementById('metaStatus');

a.src = STREAM_URL + (STREAM_URL.includes("?") ? "&" : "?") + "t=" + Date.now(); // evitar cache
a.preload = "none";

btn.onclick = async () => {
  try {
    if (a.paused) { await a.play(); }
    else { a.pause(); }
  } catch(e) {
    console.log(e);
  }
  renderState();
};
a.onplay = renderState; a.onpause = renderState; a.onwaiting = renderState; a.onplaying = renderState;
function renderState(){
  st.textContent = a.paused ? "‚è∏ Aturat" : "üì° En directe";
  btn.textContent = a.paused ? "‚ñ∂ Reproduir" : "‚è∏ Pausar";
}
vol.oninput = () => a.volume = vol.value;

document.getElementById('refresh').onclick = () => { fetchTitle(true); };

async function fetchTitle(manual=false){
  let title = null, okUrl = null, detail="";
  for (const url of STATUS_URLS){
    try{
      const r = await fetch(url, {mode:"cors"});
      if (!r.ok) { detail = "HTTP "+r.status; continue; }
      const data = await r.json().catch(()=>null);
      if (!data) continue;

      // Icecast (global)
      if (data.icestats && data.icestats.source){
        const src = Array.isArray(data.icestats.source) ? data.icestats.source.find(s => (s.listenurl||"").includes("/stream")) || data.icestats.source[0] : data.icestats.source;
        title = src && (src.title || src.artist && src.title ? (src.artist+" - "+src.title) : src["artist"]||src["title"]);
        okUrl = url; if (title) break;
      }

      // Shoutcast v2
      if (data.streamtitle || (data.songtitle)){
        title = data.streamtitle || data.songtitle;
        okUrl = url; break;
      }
      if (data && data.data && data.data.songtitle){ // alguns proxies
        title = data.data.songtitle; okUrl = url; break;
      }
    }catch(e){ /* segueix amb el seg√ºent */ }
  }
  now.textContent = title ? title : "‚Äî";
  metaStatus.textContent = title
    ? `T√≠tol actualitzat ¬∑ font: ${okUrl || 'desconeguda'}`
    : `No s'ha pogut llegir el t√≠tol (pot ser restricci√≥ CORS o endpoint).`;
  if (manual && !title) alert("No s'ha pogut llegir la can√ß√≥ actual. El stream sona igualment.");
}
// refrescar cada 10 s
setInterval(fetchTitle, 10000);
fetchTitle();
</script>
</body>
</html>
